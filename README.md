# Python语言开发DNS服务器

**本项目主要用于学习Python开发，学习Python语法，以及算法**

**NOTE**: 已知问题
1. DNS服务关闭时，asyncio loop事件循环未正确关闭(不影响服务停止, 日志会有提示)
2. 服务关闭时未回收资源(不影响服务启停)
3. 缓存未做缓存击穿处理(不影响正常使用)

## 一、实现目标
1. 多组DNS上游服务器
多个上游dns服务器组成查询组，单个分组内的多个上游dns服务器，并发查询，即使其中某个DNS服务器查询失败，也不会影响查询。
2. 缓存加速
缓存采用LRUCache（最近最少使用）策略进行缓存，当再次查询时，可加快dns查询记录, 可持久化cache缓存（使用pickle模块）
3. 域名分流(测试条目数量二十多万，域名列表路径:src/etc/flexidns/list/)
根据域名集合，查询不同上游dns服务器。查询耗时几微妙
4. fallback后备计划(测试IP为中国ipv4、ipv6*地址段*，条目数量一万多，域名列表路径:src/etc/flexidns/list/)
根据IP集合列表，将上游dns服务器返回的IP地址进行匹配，视环境决定使用另一组上游dns服务器查询，通常是加密隧道。查询耗时几微妙
5. 多协议，多端口支持（asyncio实现）
目前完成udp，tcp协议支持，以及每种端口下多个端口同时使用
6. 支持IPv4、IPv6双栈
支持IPv4、IPv6网络，支持查询IPv4、IPv6的记录查询。可禁止IPv6的AAAA记录查询。
7. 可拦截特定类型的查询记录
使用SOA记录来响应特定记录的查询
8. 支持tls, doq协议
9. 使用命令行查询缓存报告

---
以上为已经实现
## 二、未来计划
1. 根据学习Python情况，修改代码使其更规范
2. 支持https协议
3. 根据性能情况，实现正则匹配域名
4. 自动下载更新域名集合列表与IP集合列表
5. 使用tcp进行速度探测（使用linux内核提供链接表进行探测，不使用固定端口探测）
6. 使用命令参数进行在线配置

## 三、配置方法
1. hosts配置
配置文件格式采用与linux系统下的/etc/hosts文件格式相同，
一行一个规则，一个域名可配置多个ipv4与ipv6地址
\#为注释行，将该行设置为不生效行
**格式**
`IP DOMAINNAME`

### RCode - dns响应代码
| RCode | 描述 |
| --- | --- |
| success | 无错误 |
| format_error | 请求格式错误 |
| server_failure | 服务器出错 |
| name_error | 域名不存在 |
| not_implemented | 功能未实现 |
| refused | 请求被拒绝 |

## 四、许可协议
FlexiDNS 遵循GPL v3.0协议
